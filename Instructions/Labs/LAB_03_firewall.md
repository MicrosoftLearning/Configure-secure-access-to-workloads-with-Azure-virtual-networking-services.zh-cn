---
lab:
  title: 练习 - 保护 Web 应用程序免受恶意流量的损害并阻止未经授权的访问
  module: Guided Project - Configure secure access to workloads with Azure virtual networking services
---

# 实验室：保护 Web 应用程序免受恶意流量损害并阻止未经授权的访问


## 方案
你的组织希望保护 Web 应用程序免受恶意流量的侵害并阻止未经授权的访问。

除了 NSG 和 ASG 之外，还可以配置防火墙，为 Web 应用程序添加额外的安全层。 防火墙通过配置的策略保护 Web 应用程序免受恶意流量的侵害并阻止未经授权的访问。

Azure 防火墙策略是最上层资源，包含 Azure 防火墙的安全和操作设置。 它可用于定义规则层次结构并强制实施合规性。 在此任务中，使用防火墙策略为防火墙配置应用程序规则和网络规则。 可以使用 Azure 防火墙策略来管理规则集，Azure 防火墙利用这些规则集来筛选流量。 

### 体系结构关系图

![显示包含防火墙和路由表的一个虚拟网络的示意图。](../Media/task-3.png)

### 技能任务
- 创建 Azure 防火墙。
- 创建和配置防火墙策略
- 创建应用程序规则集合。
- 创建网络规则集合。
  
## 练习说明

### 在我们的现有虚拟网络中创建 Azure 防火墙子网

1. 在门户顶部的搜索框中，输入“虚拟网络”。 在搜索结果中，选择“虚拟网络”。

1. 选择“app-vnet”****。

1. 选择“子网”。

1. 选择“**+ 子网**”。

1. 输入以下信息并选择**保存**。

    | 属性 | 值    |
    |:---------|:---------|
    |名称      | **AzureFirewallSubnet**|
    |地址范围| 10.1.63.0/24****|

    > **** 备注：将所有其他设置保留为默认值。
    

### 创建 Azure 防火墙

1. 在门户顶部的搜索框中，输入“防火墙”。 在搜索结果中选择“防火墙”。

1. 选择“+ 新建”。

1.  使用下表中的值创建防火墙。 对于未指定的任何属性，请使用默认值。
    >备注****：部署 Azure 防火墙可能需要几分钟时间。

    | 属性 | 值    |
    |:---------|:---------|
    |资源组   | RG1****  |
    |名称      | app-vnet-firewall****|
    |防火墙 SKU | **标准**|
    |防火墙管理 | **使用防火墙策略来管理此防火墙**|
    |防火墙策略| 选择“新增”****| 
    |策略名称| fw-policy****|
    |区域| **美国东部**|
    |策略层| **标准**|
    |选择虚拟网络 | **使用现有项**|
    |虚拟网络 | app-vnet**** (RG1)|
    |公共 IP 地址 | 新添：fwpip****|

    了解更多有关如何创建防火墙的信息[](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal)。

1. 选择“查看 + 创建”，然后选择“创建”。

### 更新该防火墙策略

1. 在门户顶部的搜索框中，输入“防火墙策略”。**** 在搜索结果中选择“防火墙策略”。

1. 选择 fw-policy****。

1. 选择“应用程序规则”。

1. 选择“+ 应用程序规则集合”。****

1. 使用下表中的值。 对于未指定的任何属性，请使用默认值。

    |属性|  值 |
    |:---------|:---------|
    |名称   |app-vnet-fw-rule-collection****|
    |规则集合类型| **应用程序**|
    |优先度|  **200**|
    |规则集合操作|**允许**|
    |规则集合组| DefaultApplicationRuleCollectionGroup|

    1. 在“规则”中使用下表中的值****

        |属性|  值 |
        |:---------|:---------|
        |名称   |AllowAzurePipelines****|
        |源类型|IP 地址|
        |Source|10.1.0.0/23****|
        |协议|**https** |
        |目标类型|FQDN|
        |目标|dev.azure.com, azure.microsoft.com****|

        并选择“添加”****

> 备注****：AllowAzurePipelines**** 规则允许 Web 应用程序访问 Azure Pipelines。 该规则允许 Web 应用程序访问 Azure DevOps 服务和 Azure 网站。

1.  使用下表中的值创建包含单个 IP 地址规则的网络规则集合****。 对于未指定的任何属性，请使用默认值。

1. 选择“网络规则”。

1. 选择“+ 网络规则集合”。****

1. 使用下表中的值。 对于未指定的任何属性，请使用默认值。

    |属性|  值|
    |:---------|:---------|
    |名称|  app-vnet-fw-nrc-dns****|
    |规则集合类型| **Network**|
    |优先度|  **200**|
    |规则集合操作|**允许**|
    |规则集合组| DefaultNetworkRuleCollectionGroup|

    1. 在“规则”中使用下表中的值****

        |属性|  Value|
        |:---------|:---------|
        |规则 | AllowDns****|
        |Source|    10.1.0.0/23****|
        |协议|  **UDP**|
        |目标端口| **53**|
        |目标地址| 1.1.1.1, 1.0.0.1****|

        并选择“添加”。****


    详细了解如何[创建应用程序规则](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal#configure-an-application-rule)和[创建网络规则](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal#configure-a-network-rule)。

1. 验证 Azure 防火墙和防火墙策略预配状态是否显示****“成功”。

1. 在门户顶部的搜索框中输入“防火墙”。**** 在搜索结果中选择“防火墙”。

1. 选择“app-vnet-firewall”。****

1- 验证“预配状态”是否为“成功”。********

1- 在门户顶部的搜索框中，输入“防火墙策略”****。 在搜索结果中选择“防火墙策略”。****

1. 选择 fw-policy****。

1- 验证“预配状态”是否为“成功”。********

