---
lab:
  title: 练习 04：配置网络路由
  module: Guided Project - Configure secure access to workloads with Azure virtual networking services
---

# 练习 04：配置网络路由

## 场景

要确保强制实施防火墙策略，必须通过防火墙路由出站应用程序流量。 你确定这些要求。 
+ 需要路由表。 此路由表将与前端子网和后端子网相关联。  
+ 需要路由才能筛选子网到防火墙的所有出站 IP 流量。 将使用防火墙的专用 IP 地址。 

## 技能任务

+ 创建和配置路由表。
+ 将路由表链接到子网。
  
## 体系结构关系图

![显示包含防火墙和路由表的一个虚拟网络的示意图。](../Media/task-3.png)


## 练习说明

### 创建路由表

Azure 自动为 Azure 虚拟网络中的每个子网创建[路由表](https://learn.microsoft.com/azure/virtual-network/virtual-networks-udr-overview)。 路由表包括默认[系统路由](https://learn.microsoft.com/azure/virtual-network/virtual-networks-udr-overview#system-routes)。 可以创建路由表和路由来替代 Azure 的默认系统路由。

**记录 app-vnet-firewall 的专用 IP 地址**

1. 在门户顶部的搜索框中，输入“防火墙”。 在搜索结果中选择“防火墙”。

1. 选择“app-vnet-firewall”。****

1. 选择“**概述**”并记录**专用 IP 地址**。

**添加路由表**

1. 在搜索框中输入“路由表”****。 当“路由表”出现在搜索结果中时，请选择它。

1. 在”路由表“页，选择“**+ 创建**”，然后创建路由表。 

    | 属性       | 值                        |
    | :------------- | :--------------------------- |
    | 订阅   | 选择订阅 |
    | 资源组 | RG1****                      |
    | 区域         | **美国东部**                  |
    | 名称           | `app-vnet-firewall-rt`     |

1. 选择“查看 + 创建”，然后选择“创建”。********

1. 等待路由表部署完毕，然后选择“**转到资源**”。  

### 将路由表关联到子网

1. 在门户中，继续使用路由表，选择 **app-vnet-firewall-rt**。

1. 在“**设置**”边栏选项卡中，选择“**子网**”，然后选择“**+ 关联**”。

1. 配置与前端子网的关联，然后选择“**确定**”。  

    | 属性        | 值              |
    | :-------------- | :----------------- |
    | 虚拟网络 | app-vnet**** (RG1) |
    | 子网          | 前端       |

1. 配置与后端子网的关联，然后选择“**确定**”。  

    | 属性        | 值              |
    | :-------------- | :----------------- |
    | 虚拟网络 | app-vnet**** (RG1) |
    | 子网          | backend****       |

### 在路由表中创建路由

1. 在门户中，继续使用路由表，选择 **app-vnet-firewall-rt**。

1. 在“**设置**”边栏选项卡中，选择“**路由**”，然后选择“**+ 添加**”。

1. 配置路由，然后选择“**添加**”。 

    | 属性                            | Value                                                   |
    | :---------------------------------- | :------------------------------------------------------ |
    | 路由名称                          | outbound-firewall****                                   |
    | 目标类型                    | **IP 地址**                                        |
    | 目标 IP 地址/CIDR 范围 | **0.0.0.0/0**                                           |
    | 下一跃点类型                       | **虚拟设备**                                   |
    | 下一跃点地址                    | **防火墙专用 IP 地址** |


### 通过在线培训了解更多信息

+ [在 Azure 部署中通过路由管理和控制流量流](https://learn.microsoft.com/training/modules/control-network-traffic-flow-with-routes/)。 在本模块中，你将了解如何通过实现自定义路由来控制 Azure 虚拟网络流量。 本模块有两个沙盒。 

### 关键结论

祝贺你完成本练习。 以下是要点：

+ Azure 中的网络流量自动在 Azure 子网、虚拟网络和本地网络之间传送。 系统路由控制此路由。
+ 用户定义的路由替代系统默认路由，因此流量可通过网络虚拟设备 (NVA) 进行路由。 
+ 网络虚拟设备 (NVA) 控制网络流量流。 NVA 的示例包括防火墙、负载均衡器和路由器。
+ 路由表包含路由信息，并与子网相关联。 
